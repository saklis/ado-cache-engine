# &spades; ACE - ADO Cache Engine 

ADO Cache Engine is an ORM (Object-relational mapping) tool for MS SQL Server build around the idea of caching all the required data in RAM memory of the host to decrease data access times.

ACE can be used as your standard ORM, but it main strength lies in storing data on-site where you can make us of indexing tools it provides. It's designed to be used as a provider for single point data layer solutions for web applications and service-based solutions.

## Features
* No dependency on external libraries.
* Unlimited number of tables.
* Easy-to-use caching API.
* Caching subset of data using lambda expression syntax.
* Caching data related to data already cached using lambda expression syntax relation definition.
* CRUD operations support.
* Live write operation on DB - Engine reflects any changes done on its items to the database, ensuring they're up to date.
* Indexing functionality for faster querying.
* Can work in non-cache mode if you really try.
* Automatic generation of model classes using T4 scripts through [ACE ADO Cache Engine model generation](https://github.com/saklis/ace-model-generation)

## Compatibilty
* C# 7.0 and greater
* MS SQL Server 2008 R2 and greater (older version was not tested, but should be compatibile)

## Engine
The Engine object is responsible for holding Cache items. One Engine object can handle up to one database and contains methods to create and remove new cached items (tables).

### Creating new Engine instance
To create an Engine instance just use a constructor, passing connection string as parameter.
```c#
var conStr = "DataSource=db_server;InitialCatalog=db_name;UserID=user;Password=Pa$$w00rd";
var engine = new AdoCacheEngine(conStr);
```

### Data model
Engine instance can be used to create and destroy ADO Cache Items. Item is responsible for all interaction of Engine with particular table.

To create new ADO Cache Item you first need a model class. This class needs to inherits from `AdoCacheEntity` and provides few useful parameters that help the Engine in properly handling tables. For more detail about technicalieties of proper model class creation (as well as T4 scripts to generate classes for you) please refer to [ACE ADO Cache Engine model generation](https://github.com/saklis/ace-model-generation).

As an example, here's some simple model class generated by T4 script:
```c#
[TableName("[User]")]
public partial class User  : AdoCacheEntity {
    public User() : base(false) { }
    protected User(bool isManagedByCacheEngine) : base(isManagedByCacheEngine) { }

    [CurrentValueField("Id")]
    protected System.Int32 _Id_current;
    [NewValueField("Id")]
    protected System.Int32 _Id_new;
    [Key]
    [AutoIncrement]
    [ReadOnly]
    public System.Int32 Id { 
        get => _Id_current;
        set {
            if (IsManagedByCacheEngine) _Id_new = value;
            else _Id_current = value;
        }
    }

    [CurrentValueField("Name")]
    protected System.String _Name_current;
    [NewValueField("Name")]
    protected System.String _Name_new;
    public System.String Name { 
        get => _Name_current;
        set {
            if (IsManagedByCacheEngine) _Name_new = value;
            else _Name_current = value;
        }
    }

    [CurrentValueField("Password")]
    protected System.String _Password_current;
    [NewValueField("Password")]
    protected System.String _Password_new;
    public System.String Password { 
        get => _Password_current;
        set {
            if (IsManagedByCacheEngine) _Password_new = value;
            else _Password_current = value;
        }
    }

    [CurrentValueField("Enabled")]
    protected System.Boolean _Enabled_current;
    [NewValueField("Enabled")]
    protected System.Boolean _Enabled_new;
    public System.Boolean Enabled { 
        get => _Enabled_current;
        set {
            if (IsManagedByCacheEngine) _Enabled_new = value;
            else _Enabled_current = value;
        }
    }

    protected override void CopyNewValues(){
        _Id_current = _Id_new;
        _Name_current = _Name_new;
        _Password_current = _Password_new;
        _Enabled_current = _Enabled_new;
    }

    public override void UndoPendingChanges(){
        _Id_new = _Id_current;
        _Name_new = _Name_current;
        _Password_new = _Password_current;
        _Enabled_new = _Enabled_current;
	}
}
```



## Third party code
* For parsing expression trees into SQL WHERE clauses I used the code from Ryan Ohs published on his blog.
You can find the post here: http://ryanohs.com/2016/04/generating-sql-from-expression-trees-part-2/
